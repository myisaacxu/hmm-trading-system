# 光大银行市场状态识别系统

基于隐马尔可夫模型(HMM)的银行股市场状态识别与交易策略应用。系统使用baostock获取光大银行历史数据，结合akshare获取的宏观数据，实现完整的市场状态识别与交易策略回测功能。

## 功能特性

- **数据获取**：使用baostock获取光大银行(601818)历史股票数据
- **宏观指标**：集成akshare获取的股债利差、巴菲特指数等宏观数据
- **状态识别**：基于HMM模型识别市场状态（牛市、熊市、中性）
- **交易策略**：根据市场状态生成多空交易信号
- **交互界面**：完整的Streamlit界面，支持参数配置和可视化展示
- **模型管理**：支持模型保存、加载和性能比较

## 技术架构

### 核心模块

1. **数据获取模块**：baostock股票数据 + akshare宏观数据
2. **特征工程模块**：技术指标计算 + 宏观指标整合
3. **HMM模型模块**：市场状态识别与平滑处理
4. **交易策略模块**：多空信号生成与收益计算
5. **界面交互模块**：Streamlit界面与可视化展示
6. **模型管理模块**：模型持久化与性能跟踪

### 技术栈

- **前端框架**：Streamlit (Python)
- **数据处理**：pandas, numpy
- **机器学习**：hmmlearn (HMM模型)
- **数据源**：baostock (股票数据)、akshare (宏观数据)
- **可视化**：plotly, matplotlib
- **模型持久化**：joblib, json

## 安装与运行

### 环境要求

- Python 3.8+
- 以下Python包：
  ```
  pip install baostock akshare hmmlearn pandas numpy matplotlib streamlit plotly joblib
  ```

### 运行应用

```bash
streamlit run 光大银行市场状态识别_streamlit.py
```

应用将在 `http://localhost:8501` 启动。

## 使用说明

### 参数配置

在侧边栏可以配置以下参数：

- **选择资产**：当前仅支持光大银行(601818)
- **开始日期**：数据获取的开始时间
- **状态数量**：HMM模型识别的状态数量（2-6）
- **最小状态持续时间**：状态平滑处理的最小天数（5-30）
- **状态粘性**：状态转移的粘性强度（1.0-20.0）
- **银行股专用参数**：波动率窗口、短期/长期均线窗口

### 功能界面

应用包含以下主要界面：

1. **光大银行走势**：价格走势与市场状态可视化
2. **指标分析**：股债利差、巴菲特指数、波动率等指标分析
3. **策略表现**：买入持有与HMM策略对比
4. **状态统计**：市场状态分布与转换矩阵

### 模型管理

- **自动保存**：开启后可自动保存表现更好的模型
- **模型比较**：与历史最佳模型进行性能对比
- **模型列表**：查看所有已保存模型的性能指标

## 数据处理流程

1. **数据获取**：从baostock获取光大银行数据，从akshare获取宏观数据
2. **特征计算**：计算对数收益率、波动率、趋势指标等
3. **数据对齐**：将宏观数据与股票数据日期对齐
4. **特征标准化**：Z-分数标准化提高状态区分度
5. **HMM训练**：训练隐马尔可夫模型识别市场状态
6. **状态平滑**：应用最小持续时间和粘性平滑
7. **策略生成**：根据市场状态生成交易信号
8. **性能评估**：计算年化收益、夏普比率、最大回撤等指标

## 算法原理

### HMM市场状态识别

使用高斯隐马尔可夫模型(Gaussian HMM)识别市场状态：

- **观测变量**：对数收益率、波动率、趋势指标、股债利差、巴菲特指数
- **隐藏状态**：市场状态（牛市/熊市/中性）
- **状态平滑**：最小持续时间约束和状态粘性优化

### 交易策略

- **牛市状态**：做多（持仓100%）
- **熊市状态**：做空（持仓-100%）
- **中性状态**：观望（持仓0%）
- **执行时机**：次日开盘执行交易信号

## 性能指标

- **年化收益率(CAGR)**：策略的年化复合增长率
- **夏普比率(Sharpe Ratio)**：风险调整后的收益指标
- **最大回撤(Max Drawdown)**：策略的最大亏损幅度
- **状态分布**：各市场状态的持续时间分布
- **转换矩阵**：市场状态之间的转换概率

## 文件结构

```
光大银行市场状态识别/
├── 光大银行市场状态识别_streamlit.py  # 主程序文件
├── README.md                           # 项目说明文档
├── test_光大银行集成.py               # 集成测试脚本
├── 完整系统测试.py                    # 完整系统测试脚本
└── trycode2/
    └── models/                        # 模型保存目录
        ├── *.joblib                   # HMM模型文件
        └── *_metrics.json            # 模型性能指标
```

## 注意事项

1. **数据源稳定性**：baostock和akshare的数据获取依赖于网络连接
2. **模型参数**：不同参数设置会影响状态识别效果，建议通过回测优化
3. **历史数据**：策略表现基于历史数据，不代表未来收益
4. **风险提示**：投资有风险，决策需谨慎

## 开发计划

- [ ] 支持更多银行股分析
- [ ] 添加更多技术指标
- [ ] 优化HMM模型参数选择
- [ ] 增加实时数据更新
- [ ] 添加风险控制模块

## 贡献指南

欢迎提交Issue和Pull Request来改进项目。

## 许可证

本项目采用MIT许可证。

## 联系方式

如有问题或建议，请通过GitHub Issues反馈。